# Импорт банковских выписок

**Импорт данных банковских операций в формате 1С —** это сервис, который позволяет выгружать данные всех транзакций по каждому счету и каждому банку в системе Bpium. Для сотрудника будут доступны такие данные как: дата, время, сумма и направление операции, а также контрагент и назначение платежа. \


С помощью данного сервиса вы сможете видеть список всех транзакций по каждому банку, а также своевременно получать актуальную информацию по всем счетам в каждом банке.

## **Принцип работы**

![](https://lh5.googleusercontent.com/rU\_p7BV\_53MqP1dGGV0txwqp5uZ5MM\_d\_AghbT9nTwk\_5tkgvDA5srrOM1F1KJHzF4e4Z7GxBPzw9Q13tU\_SsOf3utxNC4lWDOgbiwoyBx6q\_iohcprbkk8VrCbGCeDPNwezbjjC)

В личном кабинете вашего банка доступна выписка по счету в формате 1С. После выгрузки банк в ответ выдаст файл kl\_to\_1c.txt., который в дальнейшем посредством логики сценариев в Bpium необходимо распарсить и полученные данные разместить в вашем каталоге финансов.

## **Реализация**

### **Настройка структуры данных**

#### **Создание и настройка каталога «Банки»**

Создадим каталог «Банки». Каталог предназначен для хранения всех банков, с которыми вы сотрудничаете. Здесь необходимо создать одно поле:

![](https://lh5.googleusercontent.com/Q7wOOXUo2Iiq5ezXSmgbrySHOXjxpROgegtDp-0YGe42KcbfsBt\_O8\_CuElumNgCCgpagsputUJEveRjF7y4Ho84APHoBzje8X-J5mVJc3VgLfTI025OE\_qvrOhK7qMoo2h9out\_)

* **Наименование банка (текст)**

#### **Создание и настройка каталога «Банковские счета»**

Создадим каталог «Банковские счета». Этот каталог предназначен для хранения всех счетов по каждому банку. Здесь необходимо создать два поля:\


![](https://lh4.googleusercontent.com/r7oAg8wznyUQT7fPhLfjrk-gto-SA-nIbnsKgwKfm9GiKrRU-fLcV3Fz\_NZOj1JMhYLFjtV6g-6CvVgg3qCCjvu4hU2j1dn5tBgLCEVFiEdVB-mo3PteooIr-Vfx5sTUwofePjyd)

* **Банк (связанный каталог)**
* **Банковский счет (текст)**

#### **Создание и настройка каталога «Финансы»**

Создайте каталог «Финансы». Этот каталог предназначен для хранения всех операций по выписке. Для учета необходимо создать следующие поля:\


![](https://lh5.googleusercontent.com/rN5TX3spe3RMZY9G8yFaW83ZMAV-A0msiMiMVnqrYtaem8EBACJ8Ch7cBXlnW\_0N8AbDLL8TLSKZPqseZGSBE7aqxSywm6ZTCC9kr1uyAsLM-4njeRT30cbh3nvdzBMV-t05zKKs)

* **Дата операции (дата)**
* **Сумма операции (число)**
* **Тип платежа (статус). Доступные варианты выбора: доход, расход**
* **Контрагент (текст)**

Наименование организации, участвовавшая в операции&#x20;

* **Банк (связанный каталог)**

Каталог, в котором хранится вся база банков

![](https://lh6.googleusercontent.com/J3td92ZUTa1SsMRdpe1wMfsLtVKI6FCQxXdhhahLIVz6eiUt7FztgcHyhsmFHCc3hpQeuHvgCAzcy\_1Ntr0HTTzM275\_AWZDPUGicEjQ\_YPb8yuoWLS62GjpmjNAKsW9D-tNDpfa)

* **Банковский счет (связанный каталог)**

Каталог, в котором хранится вся база банковских счетов со связью Банк→счетНазначение платежа (многострочный текст)

#### **Создание и настройка каталога «Выписки»**

Создадим каталог «Выписки». Этот каталог предназначен для того, чтобы загружать наш файл с выпиской и отслеживать статус формирования записей. Необходимо создать такие поля, как:\


![](https://lh4.googleusercontent.com/6upzeyqNpxAMD5ZtrQgjEpH58Rd\_0ZA-YrjLZqJ7uyOKnvtyrvtW956XFb-0HNTwIZy2AhMY4JqUDdmipQ1ocZWRmi7ipw3VBiNwKqGNLnXYDT11DkHhoOcoX\_d6IPN5mo38SPHT)

* **Файл (файл)**

Поле, в которое мы будем загружать файл

* **Статус формирования (статус)**

Возможные статусы: готово, формирование, техническая ошибка

### Создание события

Перейдите в каталог «События» (по умолчанию он находится в отделе «Управление») и создайте новую запись, указав в ней следующие данные:

* **Каталог**: «Выписки»
* **События**: Уведомление о создании записи
* **Отслеживать поля**: необходимо указать ID поля из каталога «Выписки» с типом файл
* **Выполнить**: пока оставляем пустым, в последующем этапе после создания сценария необходимо будет его указать

Прикладываю скрин как должна выглядеть карточка события:

![](https://lh6.googleusercontent.com/OuXVCrpqonr0hgUuF2KWIavyJGd0OVS0bA31TQk\_UqqlTgKY8oz3-EZiznMuVNmzw3kflCUGguoCwlPWinb77jsQMcr291H\_NFolL2UDhwov2\_vy2zxqvLATZLJq3S9nQWuIgIet)

### Создание сценария&#x20;

Для того, чтобы получить необходимые данные из файла и корректно их обработать, вам необходимо ознакомиться с данным форматом. Прикладываю [ссылку](https://its.1c.ru/db/metod8dev/content/3261/hdoc) для ознакомления. Далее перейдите в каталог «Сценарии» (по умолчанию он находится в отделе «Управление») и создайте новую запись, указав в ней следующие данные:

* **Название**: укажите название сценария&#x20;
* **Сценарий**: [скачайте файл](https://drive.google.com/file/d/10qGO7obdc2NL99LaYpxTlfA\_vWwJpmpN/view?usp=sharing) сценария и загрузите его в поле

![](<../../.gitbook/assets/image (21).png>)

* **Настройка сценария**: в сценарии вам необходимо поменять id полей соответственно с вашими id полями в каталогах. Далее детальнее по каждому изменению: В компоненте "NEED TO CHANGE" есть 5 объектов, в которых вам необходимо произвести изменения:

```
extractStatusFieldId = {
  fieldId : '4', // укажите Id поля «статус формирования» в каталоге «Выписки»
  ok : ['1'], // укажите Id статуса «Готово» в поле «статус формирования» в каталоге «Выписки» 
  err: ['3'], // укажите Id статуса «Техническая ошибка» в поле «статус формирования» в каталоге «Выписки» 
  edit:['2'] // укажите Id статуса «Формирование» в поле «статус формирования» в каталоге «Выписки» 
}

financeFieldsId = {
  catId: '31', // укажите Id каталога «Финансы»
  date: '2', // укажите Id поля «Дата» в каталоге «Финансы»
  price: '3', // укажите Id поля «Сумма операции» в каталоге «Финансы»
  type: '4', // укажите Id поля «Тип операции» в каталоге «Финансы»
  counterparty: '5', // укажите Id поля «Контрагент» в каталоге «Финансы»
  bank: '6', // укажите Id поля «Банк» в каталоге «Финансы»
  bankAccount: '7', // укажите Id поля «Банковский счет» в каталоге «Финансы»
  description: '8' // укажите Id поля «Назначение платежа» в каталоге «Финансы»
}

fileId = '2' // укажите Id поля «Файл» в каталоге «Выписки»

extractFieldsId = {
  catId: '32', // укажите Id каталога «Банки»
  recId: '5' укажите Id записи Банка, который вы выбрали в каталоге «Выписки»
}

accountFieldsId = {
  catId: '33', // укажите Id каталога «Банковские счета»
  bank : '2', // укажите Id поля «Банк» в каталоге «Банковские счета»
  account: '3' // укажите Id поля «Банковский счет» в каталоге «Банковские счета»
}

```

После всех изменений сохраните сценарий и укажите его в ранее созданном событии в поле «Выполнить»

### **Тестирование**

Для тестирование необходимо зайти в личный кабинет своего банка, сформировать выписку по счету в формате 1С и скачать её. Далее перейти в каталог «Выписки» и в поле «Файл» загрузить ранее скачанный файл.После сохранения записи и смены статуса этой записи в статус «Готово», необходимо перейти в каталог «Финансы».&#x20;

Здесь вы можете проверить дату операции, сумму, контрагента, банковский счет, тип и назначение платежа.

![](https://lh5.googleusercontent.com/R0pkfPTykgLjek\_yQCAbAhHGBq5sigmXtXaUbHQT3pu-xYMjBdsr4WZwpCg5KOkKiAQICuWU5P5mHIOO4-6vZB1jAaVh2ovRKCkBAe8ZaVfAPbOausamivaJz-sMHcVoJZfPt-IV)

Банковский счет, контрагент и назначение платежа скрыты с целью безопасности от злоумышленников.