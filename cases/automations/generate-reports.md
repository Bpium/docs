---
description: Генерация отчетов в системе Бипиум
---

# Генерация excel-отчетов

## 1. Введение

**Генерация отчетов** — это сервис, который позволяет автоматизировать формирование отчетов по указанному алгоритму и с учетом указанных фильтров.

## 2. Принцип работы

![](../../.gitbook/assets/0.jpeg)

При создании новой записи в каталоге **«Отчеты»** запускается **«Сценарий генерации отчета».** Далее сценарий собирает данные по заранее заложенному алгоритму и с учетом указанных фильтро&#x432;**,** из получившихся данных формируется отчет по заранее заданному шаблону и сохраняется в поле файл карточки отчета в каталоге **«Отчеты»**.

## 3. Реализация

### 3.1. Настройка структуры данных

#### 3.1.1. Создание и настройка каталога «Отчеты»

Создайте каталог **«Отчеты»**. Данный каталог является «хранилищем» сгенерированных отчетов, именно здесь они будут храниться. При создании каталога нужно добавить и настроить поля следующим образом:

![](<../../.gitbook/assets/1 (6).png>)



* **Типы отчетов** (связанный каталог).\
  &#xNAN;_&#x41E;писание:_ Данный каталог является «справочником», в котором содержатся все типы шаблонов.
* **Компании** (связанный каталог).\
  &#xNAN;_&#x41E;писание:_ Данный каталог является «справочником», в котором содержатся все компании.

![](<../../.gitbook/assets/2 (8).png>)

![](<../../.gitbook/assets/3 (2) (1).png>)

* **Услуга** (связанный каталог).\
  &#xNAN;_&#x41E;писание:_ Данный каталог является «справочником», в котором содержатся все типы услуг.
* **Статус формирования** (статус).\
  &#xNAN;_&#x41E;писание:_ Отражает на какой стадии сейчас находится генерация.
* **Описание ошибки** (текст).\
  &#xNAN;_&#x41E;писание:_ Описывает ошибку.
* **Файл** (файл).\
  &#xNAN;_&#x41E;писание:_ В данном поле будет хранится сгенерированный отчет.

#### 3.1.2. Создание и настройка каталога «Типы отчетов»

Создайте каталог **«Типы отчетов»**. Данный каталог предназначен для хранения шаблонов отчетов. При создании каталога нужно добавить и настроить поля следующим образом:

![](<../../.gitbook/assets/4 (4) (1) (1).png>)

* **Название** (текст).\
  &#xNAN;_&#x41E;писание:_ Название для типа отчета.
* **Шаблон** (файл).\
  &#xNAN;_&#x41E;писание:_ В данном поле указывается шаблон для генерации отчета.

#### 3.1.3. Создание и настройка каталога «Компании»

Создайте каталог **«Компании»**. Данный каталог предназначен для хранения данных о компаниях, которым мы оказываем услуги. При создании каталога нужно добавить и настроить поля следующим образом:

![](<../../.gitbook/assets/5 (2) (2).png>)

* **Название** (текст).\
  &#xNAN;_&#x41E;писание:_ Название для компании.

#### 3.1.4. Создание и настройка каталога «Услуги»

Создайте каталог **«Услуги»**. Данный каталог предназначен для хранения данных о предоставляемых нами услугах. При создании каталога нужно добавить и настроить поля следующим образом:

![](<../../.gitbook/assets/6 (2) (1).png>)

* **Название** (текст).\
  &#xNAN;_&#x41E;писание:_ Название для услуги.

#### 3.1.5. Создание и настройка каталога «Заявки»

Создайте каталог **«Заявки»**. Данный каталог предназначен для хранения всего перечня наших заявок. При создании каталога нужно добавить и настроить поля следующим образом:

![](<../../.gitbook/assets/7 (6).png>)

* **Дата заявки** (дата).\
  &#xNAN;_&#x41E;писание:_ Дата поступления заявки.
* **Статус заявки** (статус).\
  &#xNAN;_&#x41E;писание:_ В каком статусе сейчас находится заявка.
* **Компания** (связанный каталог).\
  &#xNAN;_&#x41E;писание:_ Данный каталог является «справочником», в котором содержатся все компании.

![](<../../.gitbook/assets/8 (6).png>)

* **Услуга** (связанный каталог).\
  &#xNAN;_&#x41E;писание:_ Данный каталог является «справочником», в котором содержатся все типы услуг.
* **Сумма** (число).\
  &#xNAN;_&#x41E;писание:_ Общая сумма оказанных нами услуг.

### 3.2. Настройка автоматизации

#### 3.2.1. Создание и настройка события

Для создания события нужно зайти в каталог **«События»** (обычно он находится в отделе Управление). Нажать кнопку Добавить и заполнить карточку события как указано на скриншоте ниже.

Карточка события выглядит следующим образом:

![](<../../.gitbook/assets/9 (5).png>)

#### 3.2.2. Создание и настройка сценария

Создайте сценарий в каталоге **«Сценарии»**. Скачайте файл сценария и добавьте его в поле.  Данный сценарий предназначен для генерации отчетов. При создании сценария нужно добавить и настроить компоненты следующим образом:



<figure><img src="../../.gitbook/assets/сценарий (2).png" alt=""><figcaption></figcaption></figure>

Для того, чтобы реализовать данный сценарий в системе нужно изменить следующие компоненты:

**3.2.2.1. Компонент «company && service»**

Требуется изменить компонент «company && service»:



<figure><img src="../../.gitbook/assets/company&#x26;&#x26;service.png" alt=""><figcaption></figcaption></figure>

В переменных service лежит значение поля «Услуга» из каталога «Отчет».

В переменных company лежит значение поля «Компания» из каталога «Отчет».

**3.2.2.2.Компонент «Найти записи заявок»**

Требуется изменить компонент **«Найти записи заявок:**

<figure><img src="../../.gitbook/assets/найти записи заявок.png" alt=""><figcaption></figcaption></figure>

В поле «Каталог» необходимо указать ID каталога **«Заявки»**, либо в выпадающем списке выбрать каталог **«Заявки»**

**3.2.2.3 Компонент «Структура каталога»**

В поле **«ID каталога»** нужно указать ID каталога **«Заявки»**, либо в выпадающем списке указать каталог **«Заявки».**

<figure><img src="../../.gitbook/assets/структура каталога.png" alt=""><figcaption></figcaption></figure>

**3.2.2.4.Компонент «Массив с данными для документа»**

Требуется изменить компонент **«Код (javascript)»:**

<figure><img src="../../.gitbook/assets/Массив с данными для документа.png" alt=""><figcaption></figcaption></figure>

Изменить r.values\[ 2 ] на r.values\[ id поля «Дата заявки» из каталога «Заявки» ]. Изменить r.values\[ 3 ] на r.values\[ id поля «Статус заявки» из каталога «Заявки» ].

Изменить r.values\[ 4 ] на r.values\[ id поля «Компания» из каталога «Заявки» ].

Изменить r.values\[ 5 ] на r.values\[ id поля «Услуга» из каталога «Заявки» ].

Изменить r.values\[ 7 ] на r.values\[ id поля «Сумма» из каталога «Заявки» ]

**3.2.2.5.Компонент «Изменить запись отчета»**

Требуется изменить компонент **«Изменить запись отчета»:**



<figure><img src="../../.gitbook/assets/изменить запись отчета.png" alt=""><figcaption></figcaption></figure>

В значение полей изменить значения с 8 на API ID поля «Статус формирования» в каталоге «Отчет».

Добавляем созданный сценарий в поле «Выполнить» в карточке события созданного в пункте 3.2.1.

![](<../../.gitbook/assets/16 (1) (1) (1).png>)

#### 3.2.3 Создание шаблона Отчета

Для создания шаблона нужно создать или [скачать excel файл](https://docs.google.com/spreadsheets/d/1UEWvKIje3uYj7pV0wkUGY6fG7VLjweuT/edit?usp=sharing\&ouid=102912363003679873017\&rtpof=true\&sd=true) следующего вида:

![](<../../.gitbook/assets/17 (4).png>)

Теперь нужно загрузить его в систему. Для этого необходимо перейти в каталог «Типы отчетов» и создать карточку следующим образом:

![](<../../.gitbook/assets/18 (3).png>)

## 4. Тестирование

Тестирование функционала происходит следующим образом. Создаем карточку отчета в каталоге «Отчет»

![](<../../.gitbook/assets/19 (4).png>)

Заполняем поля «Тип отчета» и «Услуга»

![](<../../.gitbook/assets/20 (1) (1).png>)

Проверяем сгенерированный документ:

![](<../../.gitbook/assets/21 (1).png>)

![](<../../.gitbook/assets/22 (2).png>)
