# Для Bpium BPM

## **Настройка конфигурационного файла** (config.env)

Сервер локального хранилища Bpium BPM также использует переменные окружения для хранения настроек. Если переменные окружения не заданы, то Bpium BPM считывает их из файла «config.env», который находится в папке приложения Bpium BPM.

{% hint style="warning" %}
Любую переменную окружения можно передать с префиксом BPIUM\_ или без префикса. Если указаны оба, то приоритет за тем что с префиксом. Примеры:

Без префикса:

```
PARAMETER_NAME_STRING=string_value
```

С префиксом:

```
BPIUM_PARAMETER_NAME_STRING=string_value
```
{% endhint %}

### **Параметры сервера бизнес процессов, совпадающие с параметрами приложением Bpium**

| ****                                                                              |          |                                                                                                      |
| --------------------------------------------------------------------------------- | -------- | ---------------------------------------------------------------------------------------------------- |
| <p><strong><code>BPM_HOST</code></strong></p><p><code>(обязательный)</code></p>   | `string` | <p>Публичный (локальный) адрес сервера.</p><p>Пример: bpm.company.ru или 211.129.48.11.</p>          |
| `BPM_PORT`                                                                        | `int`    | Порт сервера процессов. По умолчанию: 2030.                                                          |
| <p><strong><code>BPM_SECRET</code></strong></p><p><code>(обязательный)</code></p> | `string` | <p>Секретный код доступа.</p><p>Придумайте уникальную строку.</p>                                    |
| `BPM_HTTPS`                                                                       | `bool`   | <p>Использовать SSL-сертификаты и протокол HTTPS.<br>Значения: true/false. По умолчанию: false. </p> |

### **Уникальные параметры сервера процессов**

| ****                                  |          |                                                                                                                                                                                                                                                                                                |
| ------------------------------------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `BPM_HTTPS_CERTIFICATE_PATH`          | `string` | Путь к файлу сертификата (crt).                                                                                                                                                                                                                                                                |
| `BPM_HTTPS_KEY_PATH`                  | `string` | Путь к файлу с ключом сертификата (key).                                                                                                                                                                                                                                                       |
| **`BPM_QUEUE_LOCAL`**`(обязательный)` | `bool`   | <p>Использовать локальную очередь или Redis.<br>true — локальное, false — Redis.</p><p>По умолчанию: false.</p>                                                                                                                                                                                |
| `BPM_QUEUE_HOST`                      | `string` | Публичный/локальный адрес хранилища Redis.                                                                                                                                                                                                                                                     |
| `BPM_QUEUE_PORT`                      | `int`    | Порт хранилища Redis.                                                                                                                                                                                                                                                                          |
| `BPM_QUEUE_PASSWORD`                  | `string` | Пароль доступа к Redis.                                                                                                                                                                                                                                                                        |
| `BPM_QUEUE_INTERVAL`                  | `int`    | <p>Время пересинхронизации (мс).</p><p>По умолчанию: 500</p>                                                                                                                                                                                                                                   |
| `BPM_THREADS`                         | `int`    | <p>Количество поток вычисления. По умолчанию 10.</p><p>Не рекомендуется указывать меньше 4.</p><p>Нет смысла указывать больше чем число ядер × 3.</p>                                                                                                                                          |
| `BPM_STEP_SIZE`                       | `int`    | Длина шага. Процессы исполняются шагами из нескольких компонентов, для распределения нагрузки между одновременно работающими (и потенциально зацикленными) процессами. По умолчанию: 100.                                                                                                      |
| `BPM_STEP_TIMEOUT`                    | `int`    | <p>Таймаут на исполнение шага (мс), после которого исполнение считается неудачным.<br>По умолчанию: BPM_STEP_SIZE × 10 × 1000.</p>                                                                                                                                                             |
| `BPM_STEP_ATTEMPTS`                   | `int`    | <p>Количество попыток исполнить шаг, если произошел сбой (например сервер умер во время работы).<br>По умолчанию: 1.</p>                                                                                                                                                                       |
| `BPM_STEP_MAX_DELAY`                  | `int`    | <p>Максимальная задержка между шагами (мс).</p><p>Каждый последующий шаг исполняется с задержкой.</p><p>Это сделано, чтобы изолировать зацикленные бесконечные процессы. С начала задержка близка к нулю, и постепенно квадратично увеличивается.</p><p>По умолчанию: 3600 * 1000 (1 час).</p> |
| `BPM_STEP_MAX_DELAY_ON`               | `int`    | Шаг, при котором достигается максимальная задержка. Влияет на скорость увеличения задержки между шагами. По умолчанию: 1000 (шагов).                                                                                                                                                           |
| `BPM_PROCESS_TIMEOUT`                 | `int`    | <p>Максимальное время исполнения процесса (мс).<br>По истечению этого времени, процесс прерывается с ошибкой. По умолчанию: 604800 * 1000 (1 неделя)</p>                                                                                                                                       |
| `BPM_PROCESS_DATA_LIMIT`              | `int`    | Максимальный лимит на размер переменных в процессе (байт). По умолчанию: 102400 (100 кб).                                                                                                                                                                                                      |
| `BPM_EXPRESSION_TIMEOUT`              | `int`    | Максимальное время вычисления выражения (мс). По истечению этого времени, компонент прерывается с ошибкой. По умолчанию: 500 (0,5 сек)                                                                                                                                                         |
| `BPM_CODE_DATA_LIMIT`                 | `int`    | Максимальное время исполнения кода в компоненте Код (мс). По истечению этого времени, компонент прерывается с ошибкой. По умолчанию: 5000 (5 сек)                                                                                                                                              |
| `BPM_CONSOLE_LOGIN`                   | `string` | <p>Логин на доступ к веб-консоли менеджера очереди Redis (доступна по адресу BPM_HOST/admin/). Держать ее открытой не рекомендуется, так как она создает большую нагрузку на Redis. По умолчанию: admin.<br></p>                                                                               |
| `BPM_CONSOLE_PASSWORD`                | `string` | <p>Пароль на доступ к веб-консоли очереди Redis.</p><p>Если не задан — вход запрещен.</p><p>По умолчанию: не задан.<br></p>                                                                                                                                                                    |
| `BPM_DEBUG`                           | `string` | <p>Расширенные логи компонентов. Для полных логов добавить строку ниже</p><p>server:*,bpmn-engine:*,listener,executor:worker,executor:worker:*,executor:service:bpium:*,bpm:web-request</p>                                                                                                    |

Bpium и Bpium BPM могут использовать общий файл, если стартуют из одной папки. Сервер процессов Bpium BPM может быть запущен и в другой папке или на другом сервере. В этом случае ему необходим отдельный конфигурационный файл с необходимыми для запуска и работы переменными. Конфигурационный файл размещается в папке приложения Bpium BPM.

