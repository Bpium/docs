---
description: >-
  Приложение Bpium самостоятельно не занимается резервированием сервера баз
  данных и бэкапированием данных. При необходимости требуется индивидуальная
  настройка этих процессов.
---

# Бэкап и восстановление базы

## Создание бэкапа

1. **Скопируйте файлы** сборки в отдельную папку: исполняемые файлы, конфигурационный файл, вложенные папки
2. **Сделайте бэкап** базы данных:\
   `pg_dump -h хост -d "ИМЯ_БД" -U ЛОГИН -W -Ft -b -E UTF8 -v -f "ИМЯ_ФАЙЛА"`

* `pg_dump` — утилита для создания бэкап-файла данных
* `-h` — задает адрес сервера
* `-p` — задает порт сервера (по умолчанию: 5432)
* `-d` — задает имя базы данных
* `-U` — задает имя пользователя для подключения к базе данных, чтобы все объекты сохранились, необходимо указать пользователя с соответствующими правами доступа к таким объектам
* `-W` — означает вывести запрос пароля на подключение к базе данных
* `-Ft` — ключ -F позволяет задать формат бэкап-файла, t - означает tar-формат
* `-b` — позволяет включить в бэкап большие двоичные объекты
* `-E UTF8` — выбирает кодировку UTF8 для бэкапа данных
* `-v` — выводит детали процесса создания резервной копии
* `-f` — задает путь и имя бэкап-файла



## Восстановление из бэкапа

1. **Скопируйте файлы** сборки в папку Бипиума: исполняемые файлы, конфигурационный файл, вложенные папки
2. **Восстановите базу из бэкап-файла:**\
   `pg_restore -h ВАШ_СЕРВЕР -d "ИМЯ_БД" -U ЛОГИН -W -v "ИМЯ_ФАЙЛА"`

* `pg_restore` — утилита для восстановления данных из бэкап-файлов
* `-h` — задает адрес сервера
* `-p` — задает порт сервера (по умолчанию: 5432)
* `-d` — задает имя базы данных, в которую будет восстановлен бэкап
* `-U` — задает имя пользователя для подключения к базе данных
* `-W` — означает вывести запрос пароля на подключение к базе данных
* `-v` — выводит детали процесса создания резервной копии
* `"ИМЯ_ФАЙЛА"` — задает путь и имя бэкап-файла

3. После восстановления как правило необходимо сбросить закешированные в восстановленной базе данные. Для сброса закешированных данных подключитесь к базе данных через командную строку PostgreSQL и выполните следующий скрипт:

```sql
UPDATE cache SET time = now();
```
