# Формулы

## Работа с формулами (Вычислимые поля).

Формулы позволяют автоматически вычислять значения полей на основе данных из других полей этой же записи. Это помогает исключить ошибки при ручном расчете, автоматизировать процессы и поддерживать данные в актуальном состоянии.

Для работы с формулами рекомендуем также ознакомиться со статьей [Синтаксис формул.](https://app.gitbook.com/o/-LACZmFVinTpBa6Goi4-/s/-LACZmmM2xUWbZxyRr4s/~/changes/571/bpium-setup/catalogs-setup/sintaksis-formul)

## Принцип работы

1. Создание поля: Вы создаете поле одного из поддерживаемых типов (например, "Число" или "Текст").
2. Включение формулы: В настройках поля активируется параметр "Формула по полям".
3. Написание выражения: В интерфейсе редактора задайте выражение, которое либо ссылается на значения других полей данной каталожной записи, либо производит автономные вычисления.

#### Автоматический расчет

При создании или изменении записи система автоматически вычисляет и сохраняет результат формулы в это поле. Значение нельзя изменить вручную. Также важно учитывать, что при выборе другой формулы в том же поле и последующем сохранении структуры каталога все записи будут пересчитаны.<br>

### Как настроить поле с формулой ![](../../../.gitbook/assets/unknown.png)

1. Выберите нужный каталог и перейдите в его структуру.
2. Создайте новое поле или откройте настройки существующего. Для формул подходят следующие типы полей: Число, Текст, Дата, а также Текстовый редактор, Статус, Набор галочек, Переключатель, Прогресс, Оценка звездами.
3. В блоке "Параметры" в поле “Тип вычисления” выберите “Формула по полям”.
4. В текстовое поле введите ваше выражение, используя синтаксис формул.
5. Сохраните изменения в структуре каталога.

Теперь при редактировании любой записи в этом каталоге значение в этом поле будет рассчитываться автоматически.

<figure><img src="../../../.gitbook/assets/unknown (1).png" alt=""><figcaption></figcaption></figure>

## Особенности и ограничения

* Только поля той же записи: Формулы могут ссылаться только на другие поля в пределах одной каталожной записи.&#x20;
* Запрет циклических ссылок: Нельзя создавать формулу, которая прямо или косвенно ссылается сама на себя (например, поле A зависит от B, а поле B зависит от A). Система выдаст ошибку.
* Типы данных: Следите за тем, чтобы типы данных в формуле были совместимы. Например, нельзя умножить текст на число.
* Приоритет вычислений: При расчетах приоритет вычислений у формул выше, чем у сценариев. То есть итоговое значение поля определяется формулой, но сценарии не переопределяют его, хотя и отрабатывают успешно. Если же изменять другие поля без вычислений - изменения устанавливаются из сценария корректно.

Редактор формул\
![](<../../../.gitbook/assets/unknown (2).png>)

\
Интерфейс редактора формул&#x20;
--------------------------------

Интерфейс редактора формул состоит из нескольких ключевых областей, которые помогают быстро и правильно создавать выражения.

#### Панель вставки элементов

Верхняя панель содержит выпадающие меню для быстрого добавления в формулу различных элементов:

* Поле: Позволяет вставить системное имя любого поля из текущего каталога, чтобы использовать его значение в расчете.
* Функция: Содержит список всех доступных функций, сгруппированных по категориям (Строка, Число, Дата, Логические, Массивы, Системные) предоставляют доступ к операторам и константам (например, математическим операторам, скобкам, значениям true/false).

#### Область написания формулы

Основное текстовое поле, где вы вручную набираете или собираете выражение. Здесь отображается сама формула, например, FLOOR({Цена}, 2) - будет округлять стоимость товара до 2-х знаков после запятой.

#### Подсказка по синтаксису

Под областью ввода динамически отображается краткая справка по выбранной или набираемой функции. В данном примере показан синтаксис функции FLOOR, которая округляет число в меньшую сторону: FLOOR(число, точность). Это помогает правильно использовать аргументы функции без необходимости запоминать их.

\
<br>
