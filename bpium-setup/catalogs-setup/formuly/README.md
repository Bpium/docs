---
description: >-
  Благодаря формулам вы сможете самостоятельно настроить автоматический расчет
  значения поля, например итоговую стоимость товара.
---

# Формулы

> ![](<../../../.gitbook/assets/image (7).png>)
>
> Обратите внимание: функционал по применению формул на заключительном этапе реализации, поэтому пока не доступен в системе.&#x20;

## Работа с формулами (Вычислимые поля)

Формулы позволяют автоматически вычислять значения полей на основе данных из других полей этой же записи. Это помогает исключить ошибки при ручном расчете, автоматизировать процессы и поддерживать данные в актуальном состоянии.

Для работы с формулами рекомендуем также ознакомиться со статьей [Синтаксис формул](https://app.gitbook.com/o/-LACZmFVinTpBa6Goi4-/s/-LACZmmM2xUWbZxyRr4s/~/changes/572/bpium-setup/catalogs-setup/primenenie-formul/sintaksis-formul).

### Принцип работы

1. Создание поля, которое поддерживает функцию применения формул (например: "Число", "Текст").
2. Включение формулы в настройках поля путем активации параметра "Формула по полям".
3. Написание выражения в интерфейсе редактора&#x20;

#### Автоматический расчет

При создании или изменении записи система автоматически вычисляет и сохраняет результат формулы в это поле. Значение нельзя изменить вручную.&#x20;

> Важно учитывать, что при изменении формулы в поле структуры каталога все уже созданные записи будут также пересчитаны.

### Настройка поля с формулой<br>

<figure><img src="../../../.gitbook/assets/unknown.png" alt=""><figcaption></figcaption></figure>

1. Выберите нужный каталог и перейдите в его структуру.
2. Создайте новое поле или откройте настройки существующего. Для формул подходят следующие типы полей: Число, Текст, Дата,Текстовый редактор, Статус, Набор галочек, Переключатель, Прогресс, Оценка звездами
3. В блоке "Параметры" в поле “Тип вычисления” выберите “Формула по полям”.
4. В текстовое поле введите ваше выражение, используя [Синтаксис формул](https://app.gitbook.com/o/-LACZmFVinTpBa6Goi4-/s/-LACZmmM2xUWbZxyRr4s/~/changes/572/bpium-setup/catalogs-setup/primenenie-formul/sintaksis-formul).
5. Сохраните изменения в структуре каталога.

Теперь при редактировании любой записи в этом каталоге значение в этом поле будет рассчитываться автоматически.

<figure><img src="../../../.gitbook/assets/unknown (1).png" alt=""><figcaption></figcaption></figure>

## Особенности и ограничения

* Только поля той же записи: Формулы могут ссылаться только на другие поля в пределах одной  записи данного каталога.&#x20;
* Запрет циклических ссылок: Нельзя создавать формулу, которая прямо или косвенно ссылается сама на себя (например, поле A зависит от B, а поле B зависит от A). Система выдаст ошибку.
* Типы данных: Следите за тем, чтобы типы данных в формуле были совместимы. Например, нельзя умножить текст на число.
* Приоритет вычислений: При расчетах приоритет вычислений у формул выше, чем у сценариев. То есть итоговое значение поля определяется формулой, но сценарии не переопределяют его, хотя и отрабатывают успешно. Если же изменять другие поля без вычислений - изменения устанавливаются из сценария корректно.

### Интерфейс редактора формул&#x20;

Интерфейс редактора формул состоит из нескольких ключевых областей, которые помогают быстро и правильно создавать выражения.

<figure><img src="../../../.gitbook/assets/unknown (2).png" alt=""><figcaption><p>Редактор формул</p></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption><p>Редактор формул. Элементы.</p></figcaption></figure>

#### Панель вставки элементов

Верхняя панель содержит выпадающие меню для быстрого добавления в формулу различных элементов:

* **Поле:** Позволяет вставить системное имя любого поля из текущего каталога, чтобы использовать его значение в расчете.
* **Функция:** Содержит список всех доступных функций, сгруппированных по категориям (Строка, Число, Дата, Логические, Массивы, Системные) предоставляют доступ к операторам и константам (например, математическим операторам, скобкам, значениям true/false).

#### Область написания формулы

Основное текстовое поле, где вы вручную набираете или собираете выражение. Здесь отображается сама формула, например, FLOOR({Цена}, 2) - будет округлять стоимость товара до 2-х знаков после запятой.

#### Подсказка по синтаксису

Под областью ввода динамически отображается краткая справка по выбранной или набираемой функции. В данном примере показан синтаксис функции FLOOR, которая округляет число в меньшую сторону: FLOOR(число, точность). Это помогает правильно использовать аргументы функции без необходимости запоминать их.

## Примеры использования формул

### Расчет стоимости продукта с НДС

Автоматизируйте расчет стоимости для клиентов с помощью формул даже на nocode-решении. Система будет автоматически вычислять итоговые суммы, учитывая скидки и налоги.

1. Создайте каталог "Клиенты", в котором будет храниться ваша база контрагентов. Рекомендуемые поля каталога "Клиенты":

<table><thead><tr><th width="179.6953125">Название поля</th><th width="452.83203125">Тип поля</th></tr></thead><tbody><tr><td>Название</td><td>Текст</td></tr><tr><td>Менеджер</td><td>Связанный каталог с каталогом Сотрудники</td></tr><tr><td>Тип скидки</td><td>Выпадающий список (Постоянный, VIP, Стандартный)</td></tr><tr><td>Телефон</td><td>Текст</td></tr><tr><td>Email</td><td>Текст</td></tr></tbody></table>

2. Создайте каталог "Продукты/Услуги", в котором будут храниться номенклатуры с базовыми ценами. Рекомендуемые поля каталога "Продукты/Услуги":

<table><thead><tr><th width="178.4765625">Название поля</th><th width="447.16796875">Тип поля</th></tr></thead><tbody><tr><td>Наименование</td><td>Текст</td></tr><tr><td>Базовая цена</td><td>Число</td></tr><tr><td>Категория</td><td>Выпадающий список (Товары, Услуги, Работы)</td></tr><tr><td>Единица измерения</td><td>Выпадающий список (шт, кг, час)</td></tr><tr><td>Артикул</td><td>Текст</td></tr></tbody></table>

3. Создайте каталог "Калькулятор коммерческих предложений" с рекомендуемыми полями. Рекомендуемые поля каталога "Калькулятор коммерческих предложений":&#x20;

<table><thead><tr><th width="158.8828125">Название поля</th><th width="182.43359375">Тип поля</th><th>Формула</th></tr></thead><tbody><tr><td>Клиент </td><td>Связанный каталог с каталогом "Клиенты" </td><td>-</td></tr><tr><td>Менеджер</td><td>Связанный каталог с каталогом Сотрудники</td><td>-</td></tr><tr><td>Продукт</td><td>Связанный каталог с каталогом "Продукты/Услуги" </td><td>-</td></tr><tr><td>Количество</td><td>Число</td><td>-</td></tr><tr><td>Цена за единицу</td><td>Число</td><td>-</td></tr><tr><td>Скидка %</td><td>Число</td><td>-</td></tr><tr><td>НДС - Число </td><td>Число</td><td>-</td></tr><tr><td>Стоимость без скидки</td><td>Число</td><td>{Количество} * {Цена за единицу}</td></tr><tr><td>Сумма скидки</td><td>Число</td><td>{Стоимость без скидки} * {Скидка %} / 100</td></tr><tr><td>Стоимость со скидкой</td><td>Число</td><td>{Стоимость без скидки} - {Сумма скидки}</td></tr><tr><td>Сумма НДС </td><td>Число</td><td>{Стоимость со скидкой} * {НДС} / 100</td></tr><tr><td>Итоговая сумма </td><td>Число</td><td>{Стоимость со скидкой} + {Сумма НДС}</td></tr></tbody></table>

4. Добавьте формулы в поля, которые будут рассчитываться. В нашем примере будут рассчитываться следующие поля: Стоимость без скидки, Сумма скидки, Стоимость со скидкой, Сумма НДС, Итоговая сумма.

<figure><img src="../../../.gitbook/assets/unknown (4).png" alt=""><figcaption></figcaption></figure>

Теперь при создании нового коммерческого предложения после заполнения полей система будет рассчитывать итоговые значения по заданным формулам в режиме реального времени.

#### Дополнительная настройка с применением автоматизаций

* Настройка поля Клиент: при заполнении пользователем поля Клиент система будет автоматически подставлять персональную скидку. (Подробнее в статьях [События](../../processes/events/), [Изменение данных](../../processes/events/datachanged.md), [Сценарии](../../processes/scripts/))
* Настройка поля Продукт: при выборе пользователем продукта система автоматически подставляет базовую цену продукта. (Подробнее в статьях [События](../../processes/events/), [Изменение данных](../../processes/events/datachanged.md), [Сценарии](../../processes/scripts/))

\
\
<br>
