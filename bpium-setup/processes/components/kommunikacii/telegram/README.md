# Telegram

Компонент «Telegram» позволяет автоматически отправлять сообщения и медиафайлы в чаты и каналы Telegram прямо из бизнес-процессов Bpium. Это идеальный инструмент для мгновенных уведомлений о новых заявках, изменениях статусов или для отправки ежедневных отчетов. Позволяется отправка, как с личных аккаунтов так и посредством ботов полученных от BotFather телеграма.

#### Общие свойства

* Название (обязательное) — Уникальное имя компонента для его идентификации внутри процесса.
* Описание (необязательное) — Дополнительная информация о том, для чего используется этот компонент.
* Область применения: Автоматизация, Уведомления, Интеграции

### Подключение

Перед использованием компонента его необходимо авторизовать.

* Авторизационный токен (обязательное) — Это ключ доступа вашего аккаунта/бота. Чтобы получить токен ознакомьтесь с правилами работы сервиса токенов bpium.
* Тип подключения (обязательное) — Определяет контекст, от имени которого будет отправлено сообщение. Доступные варианты: Пользователь, бот.



## Получение авторизационного токена

Для получения токена понадобится API ID и API Hash от Telegram.

### Получение API ID и API Hash

Чтобы получить API ID и API Hash перейдите по адресу [https://my.telegram.org/auth](https://my.telegram.org/auth) и войдите с помощью номера телефона, который хотите привязать в качестве отправителя.

<figure><img src="../../../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Перейдите в API development tools и создайте новое приложение, заполнив поля:

* **App title:** придумайте и введите полное название своего приложения, которое регистрируется для получения доступа к инструментам разработчика в Telegram.
* **Short name:** придумайте и введите короткое название своего приложения.
* **URL:** введите ссылку сайта Бипиум `https://bpium.ru`
* **Platform:** выберите операционную систему приложения. По умолчанию можно выбрать `Desktop`
* **Description:** заполните поле описания (обязательный шаг)

Нажмите `Create application`  чтобы получить поля конфигурации API (App api\_id, App api\_hash).    &#x20;

<figure><img src="../../../../../.gitbook/assets/image (4) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



<figure><img src="../../../../../.gitbook/assets/image (237).png" alt=""><figcaption><p>Автоматизации: сервис получения токенов. Заполнение полей конфигурации API</p></figcaption></figure>

### Получение токена&#x20;

Откройте [tokens.bpium.ru](https://tokens.bpium.ru/) и выберите сервис, для которого хотите получить токен.&#x20;

<figure><img src="../../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

В открывшемся окне введите ранее полученные  `API ID` и `API Hash`, а также Номер телефона, который был использован при получении  `API ID` и `API Hash`.

<figure><img src="../../../../../.gitbook/assets/image (19).png" alt=""><figcaption><p>Автоматизации: сервис получения токенов</p></figcaption></figure>

После подтверждения авторизации на 3 шаге вы получите ключ, который необходимо скопировать. Этот ключ и есть необходимый вам токен.

<figure><img src="../../../../../.gitbook/assets/image (239).png" alt=""><figcaption><p>Автоматизации: сервис получения токенов</p></figcaption></figure>

Вернитесь в систему Бипиум и в разделе Управление в каталоге Сценарии откройте сценарий, в котором необходимо добавить компонент Telegram. Перетащите компонент в поле сценария и заполните поля компонента.

<figure><img src="../../../../../.gitbook/assets/image (230).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

### Заполнение полей компонента

<figure><img src="../../../../../.gitbook/assets/image (232).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

* **Действие**  — Выберите действие, которое должен выполнить компонент. На данный момент доступны следующие действия ”Отправить сообщение, Отправить геолокацию, Отправить контакт, Переслать сообщение, Изменить сообщение, Удалить сообщение, Получить диалоги, Получить профиль, Получить сообщения”.
* **Диалог** — Уникальный идентификатор чата, куда будет отправлено/получено сообщение. Это может быть @username пользователя или публичного канала, либо числовой chat\_id группового чата или личного диалога.
* **Текст**  — Текстовая часть отправляемого сообщения. Вы можете использовать статический текст или динамические данные, подставляя значения через выражения и переменные из процесса (например, allValues.message).
* **Формат текста** — Позволяет выбрать разметку для текста. Доступные варианты: Markdown или HTML. Используйте этот параметр, чтобы добавить в сообщение жирный шрифт, курсив, списки или ссылки.
* **Вложения** — Позволяет прикрепить к сообщению файлы (изображения, документы, видео и т.д.). Для загрузки файла укажите выражение, которое возвращает его fileId (Формат: массив объектов вида \[ { title: "...", url: "https://..." }, ... ]).
* Ответить на сообщение — Позволяет отправить сообщение как ответ на конкретное другое сообщение в чате. Для этого укажите message\_id сообщения, на которое нужно ответить.
* ID сообщения — Дополнительное поле, заполняется при выборе опции Ответить на сообщение.
* Отправить без уведомления — Если эта опция активна, сообщение будет отправлено «бесшумно». Пользователи в чате не получат звукового уведомления или push-пуш.

<figure><img src="../../../../../.gitbook/assets/image (235).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

#### Поля для заполнения при типе подключения Бот:

* **Кнопки** — параметр доступен только для рассылки ботами

Объект вида:

```
Inline-клавиатура: { "inline_keyboard": [[{ "text": 
"Открыть сайт", "url": "https://example.com" }]] }; 

 Reply-клавиатура: { "keyboard": [[{ "text": "Привет" }, 
 { "text": "Локация", "request_location": true }]], "resize": true }; 
 Удалить клавиатуру: { "remove_keyboard": true}.
```

<figure><img src="../../../../../.gitbook/assets/image (236).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

#### Поля для подключения при типе подключения Пользователь:

* **Формат отправки вложений** — Позволяет выбрать формат: Markdown / HTML
* Отправить позже —  Если эта опция активна, сообщение будет отправлено в заданную Дату.
* Дата отправки — Дополнительное поле, заполняется при выборе опции Отправить позже.

<figure><img src="../../../../../.gitbook/assets/image (234).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

## Результат

Результат работы компонента можно сохранить в переменную процесса для дальнейшего использования в логике.

* **Сохранить результат в** —  Укажите имя переменной, в которую будет записан ответ от сервера Telegram.&#x20;

В эту переменную сохранится объект с данными отправленного сообщения (например, его уникальный message\_id). Это полезно, если вы планируете later редактировать это сообщение или отвечать на него в рамках этого же процесса.

<figure><img src="../../../../../.gitbook/assets/image (233).png" alt=""><figcaption><p>Автоматизации: Компонент Telegram</p></figcaption></figure>

## Вариант использования

### &#x20;Уведомление клиента о статусе заказа

Цель: При изменении статуса заказа на «Готов к выдаче» отправить уведомление клиенту в «Telegram».





1. Создайте сценарий, инициируемый изменением статуса в каталоге «Заказы».
2. Добавьте компонент «Telegram» в холст процесса.
3. Настройте подключение: в поле Авторизационный токен выберите заранее настроенное подключение к Telegram API.
4. Заполните параметры:

*  Действие:    Отправить сообщение
* Диалог:    allValues.phone (номер телефона клиента из записи)
* Текст:   Уважаемый клиент! Ваш заказ № ${allValues.goods}, готов к выдаче. Ждем вас по адресу: г. Казань, ул. Примерная, д. 1

4. Сохраните сценарий.

Теперь при смене статуса заказа клиент будет автоматически получать уведомление в WhatsApp с актуальной информацией о его заказе.

