# Веб-запрос

Используется для выполнения HTTP-запросов к произвольной внешней системе.

## Свойства

### Секция «Запрос»

**Метод**  \
****Методы веб-запроса: `GET, POST, PATCH, PUT, DELETE, HEAD` (по умолчанию `GET`).

**Адрес (URL)**  \
****Адрес сайта (URL), по которому выполнится веб-запрос. Адрес может содержать GET-параметры. Формат: **** «значение в кавычках» или выражение.

**Формат запроса**  \
****Доступен только для методов: `POST, PATCH, PUT, DELETE` . Позволяет выбрать вариант передачи POST-параметров запроса: «ключ/значение» или «тело запроса».

**Запрос (параметры)**  \
****Доступен, если формат запроса «ключ/значение». Формат: список «параметр = значение/выражение».

**Запрос (body)**  \
****Доступен, если формат запроса «Тело запроса». Формат: **** «значение в кавычках» или выражение.

**Тип данных**  \
****Доступен, если формат запроса «Тело запроса». Определяет заголовок «Content-Type». Доступные варианты:

* JSON (application/json)
* XML (application/xml)
* SOAP (application/soap+xml)
* Plain text (text/xml)

**Заголовки (headers)**  \
****Дополнительные заголовки HTTP-запроса. Если указаны заголовки, которые уже заданы (например, Content-Type), то будут применены указанные. Можно указать несколько заголовков. Формат: список «заголовок = значение/выражение».

**Авторизация**  \
****Указывает типа авторизации. Допустимые значения: без авторизации, базовая авторизация (Basic) и OAuth2. При выборе базовой авторизации, логин и пароль можно будет ввести в предложенные поля.

**Логин**  \
****Доступен, если в качестве авторизации выбран вариант «базовая авторизация». Формат: **** «значение в кавычках» или выражение.

**Пароль**  \
****Доступен, если в качестве авторизации выбран вариант «базовая авторизация». Формат: **** «значение в кавычках» или выражение.

**Токен**  \
****Доступен, если в качестве авторизации выбран вариант «OAuth2». Используется для авторизации во многие общеизвестные интернет сервисы (Фейсбук, Гугл, Яндекс). Позволяет выбрать или создать шаблон авторизационных ключей для запросов с авторизацией по протоколу OAuth. Подробнее в статье «[Доступ к сервисам](../../../structure/systemcatalogs/oauthservices.md)». Формат: **** «значение в кавычках» или выражение.

### Секция «Ответ»

**Ожидать ответа** \
****Позволяет указать ждать ли компоненту ответа от стороннего сервера.

**Код HTTP-ответа в**  \
****Выходной параметр. Сохраняет код ответа в указанную переменную. Формат: имя переменной.

**Формат ответа**\
****Способ выбора в каком формате сохранить результат веб-запроса. Доступные варианты: текст и JSON. Вариант «текст» подойдет, когда вы хотите получить ответ веб-запроса «как есть» без каких-либо преобразований. Вариант «JSON» пытается преобразовать ответ веб-запроса в объект, используя метод JSON.parse(). Этот вариант подойдет для обмена веб-запросов к сервисам возвращающих данные в формате JSON.

{% hint style="info" %}
#### Пример

Если выбран вариант «текст», то ответ `{v: 17}` будет считаться текстом `"{v: 17}"`

Если выбран вариант «JSON», то ответ `{v: 17}` будет считаться объектом, внутри которого есть свойство `v` со значением `17`.
{% endhint %}

**Ответ (body) в**  \
****Выходной параметр. Сохраняет тело ответа в указанную переменную. Формат: имя переменной.

**Заголовки (headers) в**  \
****Выходной параметр. Сохраняет массив заголовков ответа в указанную переменную. Формат: имя переменной.

_Куки._ Сервер может установить несколько куков, передав их в нескольких заголовках `set-cookie`. Компонент «Веб-запрос» преобразовывает их в коллекцию `cookies`. Ключи коллекции — имена установленных кук, значение — объект с значением (`value`) и параметрами куки (такие как время жизни, домен). Например, если вы сохранили заголовки в переменную `headers`, то значение куки `sessionId` будет доступно по выражению `headers['cookies']['sessionId'].['value']` или его эквиваленту `headers.cookies.sessionId.value`.

{% hint style="info" %}
В любом поле в секции «**Ответ**» можно указать ключ объекта и ответ сохранится как значения этого ключа.
{% endhint %}

## Пограничные события

![](../../../../.gitbook/assets/boundary\_any.png)

Компонент поддерживает 2 типа пограничных событий:

* Ошибка — выход из компонента, если произошла какая-либо ошибка
* Таймаут — выход из компонента, спустя заданное ограничение по времени

Если компонент завершился с ошибкой, но на нем не было пограничного события, то процесс завершается. Сообщение ошибки возвращается в результатах процесса.
