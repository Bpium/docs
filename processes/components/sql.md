# SQL-запрос

Используется для выполнения SQL-запросов к внешним базам данных.

## Свойства

### Секция «Подключение»

**Тип базы данных**  \
****Выбор протокола подключения к базе данных. Подключиться можно к одной из следующих баз данных: `PostgreSQL, MySQL, Oracle, SQLite, MsSQL`.

**Способ подключения**\
****Позволяет указать формат для подключения, передав отдельно параметры или целиком строку подключения.

_Способ подключения: Параметры_

**Адрес сервера**\
Адрес (домен или IP-адрес) сервера базы данных. Доступен, если способ подключения «Параметры». Допустимо указывать адрес хоста вместе с портом, разделенные через двоеточие. Формат: **** «значение в кавычках» или выражение.

**База данных**\
Имя базы данных. Доступен, если способ подключения «Параметры». Формат: **** «значение в кавычках» или выражение.

**Логин**\
Доступен, если способ подключения «Параметры». Формат: **** «значение в кавычках» или выражение.

**Пароль**\
Доступен, если способ подключения «Параметры». Формат: **** «значение в кавычках» или выражение.

_Способ подключения: Строка подключения_

**Строка подключения**\
Строка подключения к базе данных со всеми параметрами подключения. Для разных типов баз данных используется свой синтаксис. Подробнее в документации соответствующей базы данных. Свойство доступно, если способ подключения «Строка подключения». Формат: **** «значение в кавычках» или выражение.

Пример для PostgreSQL:

```sql
"postgres://user:password@host:port/dbname"
```

### Секция «Запрос»

**SQL-запрос**  \
****SQL-запрос или SQL-код в синтаксисе выбранного типа базы данных. Позволяет использовать именные параметры. Формат: **** «значение в кавычках» или выражение. Пример:

```sql
"Select * from tablename where id > :paramname1"
```

При формировании SQL-запроса будет подставлен параметр `paramname1`, указанный в свойстве «Параметры запроса».

**Параметры запроса**  \
****Позволяет передать именные параметры для SQL-запроса. Формат: список «параметр = значение/выражение».

Помимо использования переменных из поля **Параметры запроса** можно так же использовать глобальные сценарные переменные, посредством синтаксиса `${value}`. Например, описанный выше запрос с переменной можно описать следующим образом, при условии, что в сценарии существует переменная paramname1:

```sql
`Select * from tablename where id > ${paramname1}`
```

### Секция «Ответ»

**Ожидать ответа**  \
****Указывает дожидаться ли компоненту возврата результата запроса.

**Сохранить в**  \
****Выходной параметр. Сохраняет ответ в указанную переменную. В качестве ответа компонент возвращает массив из строк. Каждая строка представлена в виде обьекта, ключами которого являются имена колонок. Формат: имя переменной. Пример:

```javascript
[
    {
        "fieldname1": value,
        "fieldname2": value,
        ...
    },
    ...
]
```

{% hint style="info" %}
В «**Сохранить в**» можно указать ключ объекта и массив из строк сохранится как значения этого ключа.

**Пример**

Если указать в поле «**Сохранить в**» переменную`data.temp, то результат будет выглядеть следующим образом:`&#x20;

```javascript
data: {
    "temp": [
        {
            "fieldname1": value,
            "fieldname2": value,
            ...
        },
        ...
    ]
}
```
{% endhint %}

## Пограничные события

![](../../.gitbook/assets/boundary\_any.png)

Компонент поддерживает 2 типа пограничных событий:

* Ошибка — выход из компонента, если произошла какая-либо ошибка
* Таймаут — выход из компонента, спустя заданное ограничение по времени

Если компонент завершился с ошибкой, но на нем не было пограничного события, то процесс завершается. Сообщение ошибки возвращается в результатах процесса.
